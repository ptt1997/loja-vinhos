<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lojinha de Vinhos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #8B0000; }
    .produtos { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .produto { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; }
    .produto:hover { transform: translateY(-5px); }
    .produto img { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
    .produto h3 { margin: 10px 0 5px; color: #333; }
    .produto p { margin: 5px 0; color: #666; }
    .botao { margin-top: 10px; padding: 10px 15px; background: #8B0000; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
    .botao:hover { background: #a30000; }
    .finalizar { display: block; margin: 30px auto; padding: 15px 30px; background: #228B22; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
    .finalizar:hover { background: #2E8B57; }
    .carrinho-contador { 
      position: fixed; top: 20px; right: 20px; 
      background: #8B0000; color: white; 
      border-radius: 50%; width: 25px; height: 25px; 
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>üç∑ Lojinha de Vinhos</h1>
  <div class="carrinho-contador" id="carrinhoContador">0</div>
  <div class="produtos" id="produtos"></div>
  <button class="finalizar" onclick="enviarCarrinho()">‚úâÔ∏è Enviar Pedido via WhatsApp</button>

  <script>
    const url = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLiWZu-jpb9Cu1v0fimD4TAzS-LPdNqGYTaY7Q5gQ95Gk_UVRU0s3fCb5BjseDNusVj0nGZoUTy7ejp-RvTB8prPRLIO-hD71oUE2kiDeSeOoUHCJmKWI9flKqtQvpCzHEcQWnSm--FexvVtielgt5Sxop-M7LUY1-ko-Kl1rfzpFMC-S9C2WBQXDJ8U0bPI88A88PR_LHeuXaS4DWPnO-pUqpG5YUKie3vVr9id7M4pYpEm1-Es02txq_CLFQ7Lq_n3xE6R8WTz9UevO0ywK3ZS37nzUA&lib=MnQYBkRsDbv4uLRxNoSIgA-aoJlzzZ8rm";
    const numeroWhatsApp = "5546920001218";

    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

    // Atualiza contador do carrinho
    function atualizarContador() {
      document.getElementById('carrinhoContador').textContent = carrinho.length;
    }

    // Carrega produtos
    fetch(url)
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("produtos");
        data.forEach((produto, index) => {
          const card = document.createElement("div");
          card.className = "produto";
          card.innerHTML = `
            <img src="${produto["Link Imagem"]}" alt="${produto["Nome do Vinho"]}">
            <h3>${produto["Nome do Vinho"]}</h3>
            <p>${produto["Descri√ß√£o"]}</p>
            <p><strong>R$ ${produto["Pre√ßo"].toFixed(2)}</strong></p>
            <button class="botao" onclick='adicionarCarrinho(${JSON.stringify(produto)})'>Adicionar ao carrinho</button>
          `;
          container.appendChild(card);
        });
      })
      .catch(error => {
        console.error("Erro ao carregar produtos:", error);
        document.getElementById("produtos").innerHTML = "<p>N√£o foi poss√≠vel carregar os produtos. Por favor, tente novamente mais tarde.</p>";
      });

    function adicionarCarrinho(produto) {
      carrinho.push(produto);
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarContador();
      
      // Feedback visual
      const feedback = document.createElement('div');
      feedback.textContent = `${produto["Nome do Vinho"]} adicionado!`;
      feedback.style.position = 'fixed';
      feedback.style.bottom = '20px';
      feedback.style.left = '50%';
      feedback.style.transform = 'translateX(-50%)';
      feedback.style.backgroundColor = '#8B0000';
      feedback.style.color = 'white';
      feedback.style.padding = '10px 20px';
      feedback.style.borderRadius = '5px';
      feedback.style.zIndex = '1000';
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.style.opacity = '0';
        feedback.style.transition = 'opacity 0.5s';
        setTimeout(() => document.body.removeChild(feedback), 500);
      }, 2000);
    }

    function enviarCarrinho() {
      if (carrinho.length === 0) {
        alert("Seu carrinho est√° vazio!");
        return;
      }
      
      let mensagem = "Ol√°! Gostaria de comprar os seguintes vinhos:\n\n";
      let total = 0;
      
      // Agrupa itens iguais
      const itensAgrupados = {};
      carrinho.forEach(p => {
        const key = p["Nome do Vinho"];
        if (!itensAgrupados[key]) {
          itensAgrupados[key] = { ...p, quantidade: 1 };
        } else {
          itensAgrupados[key].quantidade++;
        }
      });
      
      // Monta mensagem
      Object.values(itensAgrupados).forEach(item => {
        const subtotal = item["Pre√ßo"] * item.quantidade;
        mensagem += `- ${item.quantidade}x ${item["Nome do Vinho"]} (R$ ${item["Pre√ßo"].toFixed(2)} cada) = R$ ${subtotal.toFixed(2)}\n`;
        total += subtotal;
      });
      
      mensagem += `\n*Total: R$ ${total.toFixed(2)}*`;
      mensagem += `\n\nPor favor, confirme meu pedido. Obrigado!`;
      
      const urlWhats = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
      window.open(urlWhats, '_blank');
      
      // Limpa carrinho ap√≥s envio
      carrinho = [];
      localStorage.removeItem('carrinho');
      atualizarContador();
    }

    // Inicializa contador
    atualizarContador();
  </script>
</body>
</html>
