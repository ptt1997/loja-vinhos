<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lojinha de Vinhos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #8B0000; }
    .produtos { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .produto { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; }
    .produto h3 { margin: 10px 0 5px; color: #333; }
    .botao { margin-top: 10px; padding: 10px 15px; background: #8B0000; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .botao:hover { background: #a30000; }
    .finalizar { display: block; margin: 30px auto; padding: 15px 30px; background: green; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; }
    .carrinho-contador { 
      position: fixed; top: 20px; right: 20px; 
      background: #8B0000; color: white; 
      border-radius: 50%; width: 25px; height: 25px; 
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>üç∑ Lojinha de Vinhos</h1>
  <div class="carrinho-contador" id="carrinhoContador">0</div>
  <div class="produtos" id="produtos"></div>
  <button class="finalizar" onclick="enviarCarrinho()">‚úâÔ∏è Enviar Pedido via WhatsApp</button>

  <script>
    const url = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLiWZu-jpb9Cu1v0fimD4TAzS-LPdNqGYTaY7Q5gQ95Gk_UVRU0s3fCb5BjseDNusVj0nGZoUTy7ejp-RvTB8prPRLIO-hD71oUE2kiDeSeOoUHCJmKWI9flKqtQvpCzHEcQWnSm--FexvVtielgt5Sxop-M7LUY1-ko-Kl1rfzpFMC-S9C2WBQXDJ8U0bPI88A88PR_LHeuXaS4DWPnO-pUqpG5YUKie3vVr9id7M4pYpEm1-Es02txq_CLFQ7Lq_n3xE6R8WTz9UevO0ywK3ZS37nzUA&lib=MnQYBkRsDbv4uLRxNoSIgA-aoJlzzZ8rm";
    const numeroWhatsApp = "5546920001218";

    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

    function atualizarContador() {
      document.getElementById('carrinhoContador').textContent = carrinho.length;
    }

    function carregarProdutos() {
      fetch(url)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("produtos");
          
          // Limpa mensagens de erro anteriores
          container.innerHTML = '';
          
          data.forEach(produto => {
            const card = document.createElement("div");
            card.className = "produto";
            card.innerHTML = `
              <h3>${produto["Nome do Vinho"] || produto["Nome do Vinho"]}</h3>
              <p><strong>R$ ${Number(produto["Pre√ßo"]).toFixed(2)}</strong></p>
              <button class="botao" onclick='adicionarCarrinho(${JSON.stringify({
                nome: produto["Nome do Vinho"] || produto["Nome do Vinho"],
                preco: produto["Pre√ßo"]
              })})'>Adicionar ao carrinho</button>
            `;
            container.appendChild(card);
          });
        })
        .catch(error => {
          console.error("Erro:", error);
          
          // Mensagem de erro simplificada
          document.getElementById("produtos").innerHTML = `
            <div style="grid-column:1/-1; text-align:center; color:red">
              Erro ao carregar produtos. Recarregue a p√°gina.
            </div>
          `;
          
          // Dados de teste caso a API falhe
          const dadosTeste = [
            { "Nome do Vinho": "Vinho Tinto Teste", "Pre√ßo": 50.00 },
            { "Nome do Vinho": "Vinho Branco Teste", "Pre√ßo": 45.00 }
          ];
          
          dadosTeste.forEach(produto => {
            const card = document.createElement("div");
            card.className = "produto";
            card.innerHTML = `
              <h3>${produto["Nome do Vinho"]}</h3>
              <p><strong>R$ ${produto["Pre√ßo"].toFixed(2)}</strong></p>
              <button class="botao" onclick='adicionarCarrinho(${JSON.stringify({
                nome: produto["Nome do Vinho"],
                preco: produto["Pre√ßo"]
              })})'>Adicionar ao carrinho</button>
            `;
            document.getElementById("produtos").appendChild(card);
          });
        });
    }

    function adicionarCarrinho(produto) {
      carrinho.push(produto);
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarContador();
      alert(`${produto.nome} adicionado ao carrinho!`);
    }

    function enviarCarrinho() {
      if (carrinho.length === 0) {
        alert("Seu carrinho est√° vazio!");
        return;
      }
      
      let mensagem = "Ol√°! Gostaria de comprar:\n\n";
      let total = 1;
      
      carrinho.forEach(item => {
        mensagem += `- ${item.nome} (R$ ${Number(item.preco).toFixed(2)})\n`;
        total += Number(item.preco);
      });
      
      mensagem += `\nTotal: R$ ${total.toFixed(2)}`;
      
      const urlWhats = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
      window.open(urlWhats, '_blank');
      
      // Limpa o carrinho ap√≥s envio
      carrinho = [];
      localStorage.removeItem('carrinho');
      atualizarContador();
    }

    // Inicializa o site
    document.addEventListener('DOMContentLoaded', () => {
      carregarProdutos();
      atualizarContador();
    });
  </script>
</body>
</html>
